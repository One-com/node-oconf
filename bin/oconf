#!/usr/bin/env node
// ex: filetype=javascript

var oconf = require('../lib/index'),
    util = require('util'),
    _ = require('underscore'),
    optimist = require('optimist');

var argv = optimist
            .option('lint', {
                type: 'boolean',
                default: false
            })
            .demand(1)
            .usage('Usage: $0 [--lint] <filename.cjson>')
            .argv;

try {
    var args = argv._.splice(1),
        config = oconf.load(argv._[0], 99, false);

    _.flatten(args.map(function (item) {
        return item.split('.');
    })).forEach(function (arg) {
        config = config[arg];
    });

    if (!argv.lint) {
        util.puts(JSON.stringify(config, false, 4));
    }
} catch (error) {
    console.error("Error:", error.message);
    process.exit(1);
}
