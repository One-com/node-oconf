#!/usr/bin/env node
// ex: filetype=javascript

var oconf = require('../lib/index'),
    util = require('util'),
    argv = require('optimist')
        // TODO: Remove this option in v4.
        .option('lint', {
            type: 'boolean'
        })
        .option('ignore', {
            type: 'string'
        })
        // TODO: Remove this option in v4.
        .option('bare', {
            type: 'boolean'
        })
        // TODO: Remove this option in v4.
        .option('allowmissing', {
            type: 'boolean'
        })
        .demand(1)
        .usage('Usage: $0 [--ignore <filename>] <filename.cjson>')
        .argv;

// TODO: Remove this check for the lint option in v4.
if (argv.lint) {
    console.warn('The option --lint is replaced by oconf-lint.');
    process.exit(1);
}

try {
    var config = oconf.load(argv._[0], {ignore: argv.ignore}),
        pathToValue = argv._.splice(1);

    // TODO: Remove this check in v4.
    if (argv.allowmissing || argv.bare || pathToValue.length > 0) {
        console.warn('oconf no longer supports extracting values this way. Use oconf-extract-option instead.');
        process.exit(1);
    }

    util.puts(JSON.stringify(config, false, 4));
} catch (error) {
    console.error("Error:", error.message);
    process.exit(1);
}
